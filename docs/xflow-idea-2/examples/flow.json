{
  "id": "salesFlow",
  "initial": "quote.start",
  "context": {
    "session": {
      "channel": "web",
      "userId": null
    },
    "quote": {},
    "errors": {}
  },
  "states": {
    "quote": {
      "initial": "start",
      "states": {
        "start": {
          "view": {
            "moduleId": "mfe-quote-start",
            "slot": "main"
          },
          "bind": [
            {
              "from": "query.token",
              "to": "session.token"
            }
          ],
          "invoke": [
            {
              "id": "loadUser",
              "type": "http",
              "config": {
                "url": "/bff/user",
                "method": "GET",
                "auth": "session.token"
              },
              "assignTo": "session.user"
            }
          ],
          "on": {
            "NEXT": {
              "target": "coverage",
              "actions": [
                {
                  "type": "assign",
                  "to": "quote.basic",
                  "fromEventPath": "payload.basic"
                }
              ]
            }
          }
        },
        "coverage": {
          "view": {
            "moduleId": "mfe-coverage",
            "slot": "main"
          },
          "invoke": [
            {
              "id": "getCoverages",
              "type": "http",
              "config": {
                "url": "/bff/coverages?productId={quote.basic.productId}"
              },
              "assignTo": "quote.coverages"
            }
          ],
          "on": {
            "COVERAGE.CHANGE": {
              "actions": [
                {
                  "type": "assign",
                  "to": "quote.selection",
                  "fromEventPath": "payload"
                }
              ]
            },
            "NEXT": "summary",
            "BACK": "#salesFlow.quote.start"
          }
        },
        "summary": {
          "view": {
            "moduleId": "mfe-summary",
            "slot": "main"
          },
          "on": {
            "CONFIRM": "submitting",
            "BACK": "coverage"
          }
        },
        "submitting": {
          "invoke": [
            {
              "id": "saveQuote",
              "type": "http",
              "config": {
                "url": "/bff/quote",
                "method": "POST",
                "body": "{quote}"
              }
            }
          ],
          "onDone": "#salesFlow.done",
          "onError": {
            "target": "summary",
            "actions": [
              {
                "type": "assign",
                "to": "errors.submit",
                "fromEventPath": "error.message"
              }
            ]
          }
        }
      }
    },
    "done": {
      "type": "final"
    }
  }
}
